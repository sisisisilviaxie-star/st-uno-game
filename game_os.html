```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game OS - SillyTavern Extension</title>
    <style>
        /* =========================================
           SYSTEM STYLES (Game OS Ê†∏ÂøÉÊ†∑Âºè)
           ========================================= */
        #game-os-root {
            position: fixed; top: 10%; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 450px; height: 700px; max-height: 85vh;
            background: #121212; border: 1px solid #333; border-radius: 18px;
            z-index: 2147483640; display: flex; flex-direction: column;
            box-shadow: 0 30px 80px rgba(0,0,0,0.95); overflow: hidden; 
            font-family: "Segoe UI", Roboto, Helvetica, sans-serif; user-select: none;
            color: white;
            animation: os-pop-in 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        @keyframes os-pop-in { from {opacity:0; transform:translateX(-50%) scale(0.9);} to {opacity:1; transform:translateX(-50%) scale(1);} }

        /* È°∂ÈÉ®Áä∂ÊÄÅÊ†è */
        .os-bar {
            height: 40px; background: #1e1e1e; border-bottom: 1px solid #333;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; font-weight: 600; cursor: move;
        }
        .os-title { color: #ffd700; letter-spacing: 1px; font-size: 14px; }
        .os-time { color: #888; font-size: 12px; font-weight: normal; }
        .os-close { cursor: pointer; color: #ff5f56; transition: 0.2s; font-size: 16px; }
        .os-close:hover { color: #ff3b30; text-shadow: 0 0 5px red; }

        /* Ê°åÈù¢ (Home) */
        #os-desktop {
            flex: 1; padding: 25px; 
            display: grid; grid-template-columns: repeat(4, 1fr); 
            grid-auto-rows: 90px; gap: 15px; align-content: start;
            background: linear-gradient(180deg, #2c3e50 0%, #000000 100%);
        }

        /* App ÂõæÊ†á */
        .app-icon {
            display: flex; flex-direction: column; align-items: center; gap: 6px;
            cursor: pointer; transition: transform 0.1s;
        }
        .app-icon:active { transform: scale(0.9); }
        .app-img {
            width: 56px; height: 56px; border-radius: 14px;
            display: flex; align-items: center; justify-content: center;
            font-size: 28px; background: rgba(255,255,255,0.1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .app-name { color: #eee; font-size: 11px; text-shadow: 0 1px 2px #000; }
        
        .ico-uno { background: linear-gradient(135deg, #ff5555, #ffaa00); }
        .ico-more { background: #333; color: #666; }

        /* Â∫îÁî®ËßÜÁ™óÂÆπÂô® */
        #os-viewport {
            flex: 1; display: none; background: #222; flex-direction: column;
            position: relative; animation: app-fade 0.2s ease-out;
        }
        @keyframes app-fade { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

        .app-nav {
            height: 44px; background: #2d2d2d; border-bottom: 1px solid #444;
            display: flex; align-items: center; padding: 0 10px;
        }
        .nav-btn { 
            cursor: pointer; padding: 5px 12px; border-radius: 6px; 
            background: #444; font-size: 12px; color: #ccc; 
        }
        .nav-btn:hover { background: #555; color: #fff; }
        .app-title { flex: 1; text-align: center; font-weight: bold; color: #eee; font-size: 14px; }

        /* =========================================
           UNO GAME STYLES (UNO Ê∏∏ÊàèÊ†∑Âºè)
           ========================================= */
        .uno-stage { 
            flex: 1; background: radial-gradient(circle at center, #3a6073, #16222a); 
            padding: 15px; display: flex; flex-direction: column; justify-content: space-between; 
            position: relative; overflow: hidden;
        }
        
        /* ÈÅÆÁΩ©Â±Ç */
        #ai-mask { 
            position: absolute; inset: 0; background: rgba(0,0,0,0.6); z-index: 50; 
            display: none; flex-direction: column; justify-content: center; align-items: center; 
            color: white; backdrop-filter: blur(3px); font-weight: bold; 
        }
        .spinner { width: 30px; height: 30px; border: 3px solid #fff; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Áé©ÂÆ∂Âå∫Âüü */
        .u-zone { display: flex; align-items: center; gap: 12px; }
        .uz-ai { align-items: flex-start; }
        .uz-user { justify-content: flex-end; align-items: flex-end; }
        
        .u-av { 
            width: 50px; height: 50px; border-radius: 50%; 
            border: 2px solid #fff; object-fit: cover; background: #000; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }
        .u-bub { 
            background: #fff; padding: 8px 12px; border-radius: 12px; 
            font-size: 13px; max-width: 160px; opacity: 0; transition: 0.3s; 
            color: #333; box-shadow: 0 2px 5px rgba(0,0,0,0.2); 
        }
        .u-bub.show { opacity: 1; }
        .bub-ai { border-top-left-radius: 0; }
        .bub-user { border-bottom-right-radius: 0; background: #d4edda; }

        /* ÁâåÊ°å‰∏≠ÂøÉ */
        .u-center { display: flex; justify-content: center; gap: 20px; align-items: center; margin: 10px 0; }
        .u-card { 
            width: 48px; height: 72px; background: #fff; border-radius: 6px; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: 900; font-size: 20px; border: 1px solid #ccc; 
            cursor: pointer; box-shadow: 2px 2px 6px rgba(0,0,0,0.4); position: relative; 
        }
        .c-red { background: #e74c3c; color: #fff; }
        .c-blue { background: #3498db; color: #fff; }
        .c-green { background: #2ecc71; color: #fff; }
        .c-yellow { background: #f1c40f; color: #000; }
        .c-back { background: #2c3e50; border: 2px solid #fff; color: transparent; }
        
        .u-hand { 
            display: flex; gap: 6px; overflow-x: auto; padding: 8px; 
            background: rgba(0,0,0,0.3); border-radius: 10px; 
            min-height: 90px; align-items: center; 
        }
        .u-card.playable { border: 2px solid gold; transform: translateY(-5px); }
        .u-card.disabled { opacity: 0.5; cursor: not-allowed; }

        /* ËæìÂÖ•Ê†è */
        .u-input { padding: 10px; background: #1f1f1f; display: flex; gap: 8px; border-top: 1px solid #333; }
        .u-input input { flex: 1; padding: 8px 12px; border-radius: 20px; border: none; background: #333; color: white; outline: none; font-size: 14px; }
        .u-input button { padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 13px; }
    </style>
</head>
<body>

<!-- OS ROOT CONTAINER -->
<div id="game-os-root">
    <!-- 1. Áä∂ÊÄÅÊ†è -->
    <div class="os-bar" id="os-drag-handle">
        <div class="os-title">Game OS</div>
        <div style="display:flex; align-items:center; gap:15px;">
            <span class="os-time" id="os-clock">12:00</span>
            <div class="os-close" id="os-close-btn">‚úï</div>
        </div>
    </div>

    <!-- 2. Ê°åÈù¢ (Home) -->
    <div id="os-desktop">
        <div class="app-icon" onclick="GameOS.openApp('uno')">
            <div class="app-img ico-uno">üÉè</div>
            <div class="app-name">UNO</div>
        </div>
        <div class="app-icon" onclick="alert('ÂºÄÂèë‰∏≠...')">
            <div class="app-img ico-more">‚ûï</div>
            <div class="app-name">Êõ¥Â§ö</div>
        </div>
    </div>

    <!-- 3. Â∫îÁî®ËßÜÁ™ó (Viewport) -->
    <div id="os-viewport"></div>
</div>

<!-- LOGIC SCRIPT -->
<script>
(function() {
    console.log("üéÆ Game OS Kernel Initialized");
    
    // ÁéØÂ¢ÉÊ£ÄÊµã
    if (typeof window.jQuery === 'undefined') {
        console.error("jQuery missing"); return;
    }
    const $ = window.jQuery;
    const ST = window.SillyTavern;

    // --- Á≥ªÁªüÂäüËÉΩ ---
    // ÊãñÊãΩ
    const makeDraggable = (el, handle) => {
        let isD=false, sx, sy, ix, iy;
        const start = (e) => {
            const evt = e.type==='touchstart'?e.touches[0]:e;
            isD=true; sx=evt.clientX; sy=evt.clientY; ix=el.offsetLeft; iy=el.offsetTop;
        };
        const move = (e) => {
            if(!isD) return;
            e.preventDefault();
            const evt = e.type==='touchmove'?e.touches[0]:e;
            el.style.left = (ix + evt.clientX - sx) + 'px';
            el.style.top = (iy + evt.clientY - sy) + 'px';
            el.style.margin = 0;
        };
        const end = () => isD=false;
        
        handle.addEventListener('mousedown', start); handle.addEventListener('touchstart', start);
        document.addEventListener('mousemove', move); document.addEventListener('touchmove', move, {passive:false});
        document.addEventListener('mouseup', end); document.addEventListener('touchend', end);
    };
    
    makeDraggable(document.getElementById('game-os-root'), document.getElementById('os-drag-handle'));

    // Êó∂Èíü
    setInterval(() => {
        const d = new Date();
        $('#os-clock').text(`${d.getHours()}:${String(d.getMinutes()).padStart(2,'0')}`);
    }, 1000);

    // ÂÖ≥Èó≠
    $('#os-close-btn').click(() => $('#game-os-root').remove());

    // --- OS Ê†∏ÂøÉÂØπË±° ---
    window.GameOS = {
        openApp: function(appId) {
            $('#os-desktop').fadeOut(100, () => {
                const $view = $('#os-viewport').css('display', 'flex').empty();
                if (appId === 'uno') this.launchUno($view);
            });
        },
        goHome: function() {
            $('#os-viewport').hide().empty();
            $('#os-desktop').fadeIn(200);
        },

        // --- UNO Ê∏∏ÊàèÊ®°Âùó ---
        launchUno: function($container) {
            // 1. Ê∏≤ÊüìÊ°ÜÊû∂
            $container.html(`
                <div class="app-nav">
                    <div class="nav-btn" onclick="GameOS.goHome()">‚¨Ö Ê°åÈù¢</div>
                    <div class="app-title">UNO Á´ûÊäÄÂú∫</div>
                    <div style="width:50px"></div>
                </div>
                <div class="uno-stage">
                    <div id="ai-mask"><div class="spinner"></div><div>AI ÊÄùËÄÉ‰∏≠...</div></div>
                    
                    <div class="u-zone uz-ai">
                        <img id="ai-av" class="u-av" src="">
                        <div class="u-bub bub-ai" id="ai-bub">Start?</div>
                    </div>
                    <div style="text-align:right; color:#ccc; font-size:11px; margin-top:-10px;">AI: <span id="ai-c">7</span></div>
                    
                    <div class="u-center">
                        <div class="u-card c-red" id="t-card">Start</div>
                        <div class="u-card c-back" id="d-deck">UNO</div>
                    </div>

                    <div style="margin-top:auto;">
                        <div class="u-zone uz-user">
                            <div class="u-bub bub-user" id="u-bub">...</div>
                            <img id="u-av" class="u-av" src="">
                        </div>
                        <div class="u-hand" id="my-hand"></div>
                    </div>
                </div>
                <div class="u-input">
                    <input type="text" id="chat-in" placeholder="ÂèëÈÄÅÂêåÂ±ÇÂØπËØù (‰ªÖÊú¨Â±ÄÊúâÊïà)">
                    <button id="chat-send">ÂèëÈÄÅ</button>
                </div>
            `);

            // 2. Â§¥ÂÉèÈÄªËæë
            const getAv = (t) => {
                const c = ST.getContext(); 
                if (!c) return '';
                if(t=='u') return c.userAvatar ? (c.userAvatar.includes('/') ? c.userAvatar : `/User Avatars/${c.userAvatar}`) : 'img/user-default.png';
                return (c.characterId && c.characters[c.characterId]) ? `/characters/${c.characters[c.characterId].avatar}` : '';
            };
            $container.find('#ai-av').attr('src', getAv('c'));
            $container.find('#u-av').attr('src', getAv('u'));

            // 3. Ê∏∏ÊàèÂºïÊìéÂÆû‰æã
            const Engine = {
                init: function() {
                    this.deck=[]; this.p=[]; this.a=[]; this.top=null; this.turn='player';
                    ['red','blue','green','yellow'].forEach(c=>{
                        for(let i=0;i<=9;i++) this.deck.push({col:c,val:i,type:'num'});
                        ['skip','draw2'].forEach(t=>{this.deck.push({col:c,val:t,type:t});this.deck.push({col:c,val:t,type:t})});
                    });
                    this.deck.sort(()=>Math.random()-0.5);
                    this.p=this.d(7); this.a=this.d(7); this.top=this.d(1)[0];
                    while(isNaN(this.top.val)){this.deck.push(this.top);this.top=this.d(1)[0];}
                    this.upd();
                },
                d: function(n) {
                    let r=[]; for(let i=0;i<n;i++){if(!this.deck.length)this.init(); r.push(this.deck.pop()||{col:'red',val:0,type:'num'});}
                    return r;
                },
                ok: function(c) { return c.col===this.top.col || c.val==this.top.val; },
                
                upd: function() {
                    let t=this.top.val; if(t=='skip')t='üö´'; if(t=='draw2')t='+2';
                    $container.find('#t-card').removeClass().addClass(`u-card c-${this.top.col}`).text(t);
                    $container.find('#ai-c').text(this.a.length);
                    const h = $container.find('#my-hand').empty();
                    this.p.forEach((c,i)=>{
                        let v=c.val; if(v=='skip')v='üö´'; if(v=='draw2')v='+2';
                        const el=$(`<div class="u-card c-${c.col}">${v}</div>`);
                        if(this.turn==='player'&&this.ok(c)) el.addClass('playable').click(()=>this.play(i));
                        else el.addClass('disabled');
                        h.append(el);
                    });
                },
                
                say: function(who, txt) {
                    const el=$container.find(who==='ai'?'#ai-bub':'#u-bub');
                    el.text(txt).addClass('show');
                    setTimeout(()=>el.removeClass('show'), 5000);
                },

                play: async function(i) {
                    if(this.turn!=='player')return;
                    const c=this.p[i]; this.p.splice(i,1); this.top=c;
                    if(c.type==='draw2'){this.a.push(...this.d(2));this.say('ai','(Ë¢´+2)');}
                    if(c.type==='skip'){this.upd();return;}
                    this.turn='ai'; this.upd(); await this.ai();
                },

                ai: async function() {
                    $container.find('#ai-mask').css('display','flex');
                    const valid=this.a.filter(c=>this.ok(c));
                    
                    // LLM Request
                    const ctx=ST.getContext();
                    const char=ctx.characters[ctx.characterId]?.name||"AI";
                    const prompt=`[UNO] Roleplay ${char}. Move: ${valid.length>0?"Play":"Draw"}. JSON: {"speech":"..."}`;
                    let sp="...";
                    try {
                        if(ST.generateQuietPrompt) {
                            const res=await ST.generateQuietPrompt(prompt,true,false);
                            const j=res.match(/\{[\s\S]*\}/); if(j)sp=JSON.parse(j[0]).speech;
                        }
                    } catch(e){}

                    $container.find('#ai-mask').hide();
                    this.say('ai',sp);

                    if(valid.length>0) {
                        const m=valid[Math.floor(Math.random()*valid.length)];
                        this.a.splice(this.a.indexOf(m),1); this.top=m;
                        if(m.type==='draw2')this.p.push(...this.d(2));
                        if(m.type==='skip'){this.upd();await this.ai();return;}
                    } else {
                        this.a.push(...this.d(1));
                        this.say('ai','Êë∏Áâå...');
                    }
                    this.turn='player'; this.upd();
                }
            };

            // ÁªëÂÆö‰∫ã‰ª∂
            $container.find('#d-deck').click(async()=>{
                if(Engine.turn!=='player')return;
                const c=Engine.d(1)[0]; Engine.p.push(c); Engine.say('user',`Êë∏Âà∞ ${c.col} ${c.val}`);
                if(Engine.ok(c)) { 
                    if(window.toastr) toastr.info("Êë∏Âà∞ÁöÑÁâåÂèØ‰ª•Âá∫"); Engine.upd(); 
                } else { 
                    Engine.upd(); await new Promise(r=>setTimeout(r,800)); Engine.turn='ai'; Engine.upd(); await Engine.ai(); 
                }
            });

            $container.find('#chat-send').click(()=>{
                const v=$container.find('#chat-in').val();
                if(v){ Engine.say('user',v); $container.find('#chat-in').val(''); }
            });

            Engine.init();
        }
    };

})();
</script>
</body>
</html>
```
